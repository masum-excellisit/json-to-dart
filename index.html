<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pro JSON → Dart Model</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
body{background:#0f172a;color:#e5e7eb}
textarea,pre{background:#020617!important;color:#e5e5e6}
</style>
</head>
<body class="p-4">
<div class="container">
  <h2 class="mb-3">JSON → Dart Model (fromJson, toJson, copyWith)</h2>
  <div class="row">
    <div class="col-md-6">
      <label class="mb-1">Paste API JSON</label>
      <textarea id="jsonInput" class="form-control text-light" rows="15"></textarea>
      <input id="rootClass" class="form-control mt-2" placeholder="Root class name (e.g UserResponse)" />
      <button class="btn btn-primary mt-3 w-100" id="generate">Generate Dart</button>
    </div>
    <div class="col-md-6">
      <label class="mb-1">Generated Dart Models</label>
      <pre id="output" class="p-3" style="height:500px;overflow:auto"></pre>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
let classes = {};

function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1)}
function camel(str){return str.replace(/_([a-z])/g,(g)=>g[1].toUpperCase())}

function dartType(key,val){
  if(val===null) return 'dynamic';
  if(typeof val==='number') return Number.isInteger(val)?'int':'double';
  if(typeof val==='boolean') return 'bool';
  if(typeof val==='string') return 'String';
  if(Array.isArray(val)){
    if(val.length===0) return 'List<dynamic>';
    let t = dartType(capitalize(key), val[0]);
    return 'List<'+t+'>';
  }
  if(typeof val==='object'){
    let cname = capitalize(key);
    parseObject(cname,val);
    return cname;
  }
  return 'dynamic';
}

function parseObject(className,obj){
  if(classes[className]) return;
  let fields=[];
  for(let k in obj){
    let ck = camel(k);
    let type = dartType(ck,obj[k]);
    fields.push({key:k, name:ck, type:type});
  }
  classes[className]=fields;
}

function buildClass(name,fields){
  let out=`class ${name} {\n`;
  fields.forEach(f=>out+=`  final ${f.type}? ${f.name};\n`);
  out+=`\n  ${name}({\n`;
  fields.forEach(f=>out+=`    this.${f.name},\n`);
  out+=`  });\n\n`;

  out+=`  factory ${name}.fromJson(Map<String,dynamic> json){\n    return ${name}(\n`;
  fields.forEach(f=>{
    if(f.type.startsWith('List<')){
      let inner=f.type.replace('List<','').replace('>','');
      if(['String','int','double','bool','dynamic'].includes(inner)){
        out+=`      ${f.name}: json['${f.key}']!=null ? List<${inner}>.from(json['${f.key}']) : null,\n`;
      } else {
        out+=`      ${f.name}: json['${f.key}']!=null ? List.from(json['${f.key}']).map((e)=>${inner}.fromJson(e)).toList() : null,\n`;
      }
    } else if(classes[f.type]){
      out+=`      ${f.name}: json['${f.key}']!=null ? ${f.type}.fromJson(json['${f.key}']) : null,\n`;
    } else {
      out+=`      ${f.name}: json['${f.key}'],\n`;
    }
  });
  out+=`    );\n  }\n\n`;

  out+=`  Map<String,dynamic> toJson(){\n    return {\n`;
  fields.forEach(f=>{
    if(f.type.startsWith('List<')){
      let inner=f.type.replace('List<','').replace('>','');
      if(['String','int','double','bool','dynamic'].includes(inner)){
        out+=`      '${f.key}': ${f.name},\n`;
      } else {
        out+=`      '${f.key}': ${f.name}?.map((e)=>e.toJson()).toList(),\n`;
      }
    } else if(classes[f.type]){
      out+=`      '${f.key}': ${f.name}?.toJson(),\n`;
    } else {
      out+=`      '${f.key}': ${f.name},\n`;
    }
  });
  out+=`    };\n  }\n\n`;

  out+=`  ${name} copyWith({\n`;
  fields.forEach(f=>out+=`    ${f.type}? ${f.name},\n`);
  out+=`  }){\n    return ${name}(\n`;
  fields.forEach(f=>out+=`      ${f.name}: ${f.name} ?? this.${f.name},\n`);
  out+=`    );\n  }\n}\n\n`;
  return out;
}

$('#generate').click(()=>{
  try{
    classes={};
    let json=JSON.parse($('#jsonInput').val());
    let root=$('#rootClass').val()||'RootModel';
    let isArray = Array.isArray(json);
    let rootObj = isArray ? (json.length>0?json[0]:{}) : json;
    parseObject(root, rootObj);
    let code='';
    Object.keys(classes).reverse().forEach(c=>{
      code+=buildClass(c,classes[c]);
    });
    if(isArray){
      code = `// Root Type\nList<${root}>\n\n` + code;
    }
    $('#output').text(code);
  }catch(e){alert('Invalid JSON');}
});
</script>
</body>
</html>
